<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>所有权与借用 | linyong's blog</title>
    <meta name="description" content="my blog!">
    <link rel="preload stylesheet" href="/blog/assets/style.ca6c3303.css" as="style">
    <script type="module" src="/blog/assets/app.71ed28d4.js"></script>
    <link rel="preload" href="/blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/blog/assets/chunks/framework.887c4034.js">
  <link rel="modulepreload" href="/blog/assets/chunks/theme.ddb8f0e9.js">
  <link rel="modulepreload" href="/blog/assets/rust_rust语言圣经笔记_1.基础入门_03.所有权与借用.md.5601dc62.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9aba17f7><!--[--><!--]--><!--[--><span tabindex="-1" data-v-79005633></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-79005633> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9aba17f7 data-v-bd40f502><div class="VPNavBar has-sidebar" data-v-bd40f502 data-v-1caea3c3><div class="container" data-v-1caea3c3><div class="title" data-v-1caea3c3><div class="VPNavBarTitle has-sidebar" data-v-1caea3c3 data-v-8cbe400c><a class="title" href="/blog/" data-v-8cbe400c><!--[--><!--]--><!----><!--[-->linyong&#39;s blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-1caea3c3><div class="curtain" data-v-1caea3c3></div><div class="content-body" data-v-1caea3c3><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-1caea3c3><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-1caea3c3 data-v-6f7fdd4e><span id="main-nav-aria-label" class="visually-hidden" data-v-6f7fdd4e>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/rust/" tabindex="0" data-v-6f7fdd4e data-v-a9418a39 data-v-7e0b47ba><!--[-->rust<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/导航/" tabindex="0" data-v-6f7fdd4e data-v-a9418a39 data-v-7e0b47ba><!--[-->导航<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-1caea3c3 data-v-f49be172><label title="toggle dark mode" data-v-f49be172 data-v-a901d9f6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a901d9f6 data-v-ee919f0c><span class="check" data-v-ee919f0c><span class="icon" data-v-ee919f0c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a901d9f6><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a901d9f6><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-1caea3c3 data-v-c7b8b73a data-v-10dcafda><!--[--><a class="VPSocialLink" href="https://github.com/coder-linyong" aria-label="github" target="_blank" rel="noopener" data-v-10dcafda data-v-1fb976e9><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-1caea3c3 data-v-b31599a3 data-v-4f731f8e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4f731f8e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4f731f8e><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-4f731f8e><div class="VPMenu" data-v-4f731f8e data-v-041c779f><!----><!--[--><!--[--><!----><div class="group" data-v-b31599a3><div class="item appearance" data-v-b31599a3><p class="label" data-v-b31599a3>Appearance</p><div class="appearance-action" data-v-b31599a3><label title="toggle dark mode" data-v-b31599a3 data-v-a901d9f6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a901d9f6 data-v-ee919f0c><span class="check" data-v-ee919f0c><span class="icon" data-v-ee919f0c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a901d9f6><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a901d9f6><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-b31599a3><div class="item social-links" data-v-b31599a3><div class="VPSocialLinks social-links-list" data-v-b31599a3 data-v-10dcafda><!--[--><a class="VPSocialLink" href="https://github.com/coder-linyong" aria-label="github" target="_blank" rel="noopener" data-v-10dcafda data-v-1fb976e9><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-1caea3c3 data-v-42b8a9c2><span class="container" data-v-42b8a9c2><span class="top" data-v-42b8a9c2></span><span class="middle" data-v-42b8a9c2></span><span class="bottom" data-v-42b8a9c2></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-9aba17f7 data-v-b1b2daed><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b1b2daed><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b1b2daed><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b1b2daed>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b1b2daed data-v-9e4d810d><button data-v-9e4d810d>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-9aba17f7 data-v-1d9666fd><div class="curtain" data-v-1d9666fd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-1d9666fd><span class="visually-hidden" id="sidebar-aria-label" data-v-1d9666fd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-1d9666fd><section class="VPSidebarItem level-0 collapsible collapsed" data-v-1d9666fd data-v-9614bd63><div class="item" role="button" tabindex="0" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><h2 class="text" data-v-9614bd63>rust语言圣经笔记</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-9614bd63><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-9614bd63><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-9614bd63><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-9614bd63 data-v-9614bd63><div class="item" role="button" tabindex="0" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><h3 class="text" data-v-9614bd63>1.基础入门</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-9614bd63><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-9614bd63><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-9614bd63><!--[--><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/01.%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E4%B8%8E%E7%BB%93%E6%9E%84.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>01.变量绑定与结构</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/02.%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>02.基本类型</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/03.%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%80%9F%E7%94%A8.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>03.所有权与借用</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/04.%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>04.复合类型</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/05.%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>05.流程控制</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/06.%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>06.匹配模式</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/07.%E6%96%B9%E6%B3%95%20Method.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>07.方法 Method</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-9614bd63 data-v-9614bd63><div class="item" data-v-9614bd63><div class="indicator" data-v-9614bd63></div><a class="VPLink link link" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/08.%E6%B3%9B%E5%9E%8B%E5%92%8C%E7%89%B9%E5%BE%81.html" data-v-9614bd63 data-v-7e0b47ba><!--[--><p class="text" data-v-9614bd63>08.泛型和特征</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9aba17f7 data-v-590271bf><div class="VPDoc has-sidebar has-aside" data-v-590271bf data-v-37c6600e><!--[--><!--]--><div class="container" data-v-37c6600e><div class="aside" data-v-37c6600e><div class="aside-curtain" data-v-37c6600e></div><div class="aside-container" data-v-37c6600e><div class="aside-content" data-v-37c6600e><div class="VPDocAside" data-v-37c6600e data-v-10351cd7><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-10351cd7 data-v-44aadaa2><div class="content" data-v-44aadaa2><div class="outline-marker" data-v-44aadaa2></div><div class="outline-title" data-v-44aadaa2>本文大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-44aadaa2><span class="visually-hidden" id="doc-outline-aria-label" data-v-44aadaa2> Table of Contents for current page </span><ul class="root" data-v-44aadaa2 data-v-02fe03e1><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-10351cd7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-37c6600e><div class="content-container" data-v-37c6600e><!--[--><!--]--><!----><main class="main" data-v-37c6600e><div style="position:relative;" class="vp-doc _blog_rust_rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0_1_%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8_03_%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%80%9F%E7%94%A8" data-v-37c6600e><div><h1 id="所有权与借用" tabindex="-1">所有权与借用 <a class="header-anchor" href="#所有权与借用" aria-label="Permalink to &quot;所有权与借用&quot;">​</a></h1><h2 id="所有权" tabindex="-1">所有权 <a class="header-anchor" href="#所有权" aria-label="Permalink to &quot;所有权&quot;">​</a></h2><p>内存管理的三种流派：</p><ul><li><strong>垃圾回收机制(GC)</strong>：在程序运行时不断寻找不再使用的内存，典型代表：Java、Go</li><li><strong>手动管理内存的分配和释放</strong>： 在程序中，通过函数调用的方式来申请和释放内存，典型代表：C++</li><li><strong>通过所有权来管理内存</strong>：编译器在编译时会根据一系列规则进行检查</li></ul><h3 id="栈-stack-与堆-heap" tabindex="-1">栈(Stack)与堆(Heap) <a class="header-anchor" href="#栈-stack-与堆-heap" aria-label="Permalink to &quot;栈(Stack)与堆(Heap)&quot;">​</a></h3><ul><li>栈：栈按照顺序存储值并以相反顺序取出值，这也被称作<strong>后进先出</strong>。增加数据叫做<strong>进栈</strong>，移出数据则叫做<strong>出栈</strong> 。栈中所有数据都必须占用已知固定大小的内存空间。</li><li>对于大小未知或者可能变化的数据，我们需要将它存储在堆上。当向堆上放入数据时，需要请求一定大小的内存空间。操作系统在堆的某处找到一块足够大的空位，把它标记为已使用，并返回一个表示该位置地址的 <strong>指针</strong>, 该过程被称为<strong>在堆上分配内存</strong>，有时简称为 “分配”(allocating)。该指针会被推入<strong>栈</strong> 中，因为指针的大小是已知且固定的，在后续使用过程中，你将通过栈中的指针，来获取数据在堆上的实际内存位置，进而访问该数据。</li></ul><p>性能区别：</p><ul><li>写入方面：入栈要比在堆上非配内存要快，因为无需分配空间。</li><li>读取方面：访问堆上的数据比访问栈上的数据慢，因为必须先访问栈再通过栈上的指针来访问内存。</li></ul><blockquote><p>栈数据往往可以直接存储在 CPU 高速缓存中，而堆数据只能存储在内存中。</p></blockquote><h3 id="所有权原则" tabindex="-1">所有权原则 <a class="header-anchor" href="#所有权原则" aria-label="Permalink to &quot;所有权原则&quot;">​</a></h3><blockquote><ol><li>Rust 中每一个值都被一个变量所拥有，该变量被称为值的所有者</li><li>一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者</li><li>当所有者(变量)离开作用域范围时，这个值将被丢弃(drop)</li></ol></blockquote><h3 id="变量绑定背后的数据交互" tabindex="-1">变量绑定背后的数据交互 <a class="header-anchor" href="#变量绑定背后的数据交互" aria-label="Permalink to &quot;变量绑定背后的数据交互&quot;">​</a></h3><h4 id="转移所有权" tabindex="-1">转移所有权 <a class="header-anchor" href="#转移所有权" aria-label="Permalink to &quot;转移所有权&quot;">​</a></h4><p>对于基本数据类型而言，因为固定大小的值，其值存储在栈中，赋值操作通过自动拷贝，无需在堆上分配内存。因为数据足够简单，拷贝速度远比在堆上创建内存快。如：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>对于复杂数类型而言，一个变量赋值给另一个变量其实是转移所有权。</p><p>以下面代码为例：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><a href="https://course.rs/basic/compound-type/string-slice.html" target="_blank" rel="noreferrer">String类型</a>**由存储在栈中的堆指针、字符串长度、字符串容量共同组成 **：</p><ul><li><strong>堆指针</strong>是最重要的，他指向真是存储字符串内容的堆内存</li><li>字符串容量是堆内存分配空间的大小</li><li>字符串长度是已使用的大小</li></ul><p>基于所有权原则，上面代码赋值效果其实是这样的：</p><blockquote><p><strong>当 s1 赋予 s2 后，Rust 认为 s1 不再有效，因此也无需在 s1 离开作用域后 drop 任何东西，这就是把所有权从 s1 转移给了 s2，s1 在被赋予 s2 后就马上失效了。</strong></p></blockquote><p>如果在所有权转移后再使用旧的所有则，将会报错：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">, world!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>报错如下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">error[E0382]: use of moved value: `s1`</span></span>
<span class="line"><span style="color:#A6ACCD;"> --&gt; src/main.rs:5:28</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">3 |     let s2 = s1;</span></span>
<span class="line"><span style="color:#A6ACCD;">  |         -- value moved here</span></span>
<span class="line"><span style="color:#A6ACCD;">4 |</span></span>
<span class="line"><span style="color:#A6ACCD;">5 |     println!(&quot;{}, world!&quot;, s1);</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                            ^^ value used here after move</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">  = note: move occurs because `s1` has type `std::string::String`, which does</span></span>
<span class="line"><span style="color:#A6ACCD;">  not implement the `Copy` trait</span></span></code></pre></div><p>所以Rust中如<code>let a = b</code>的变量定义被叫做<strong>变量绑定</strong></p><h4 id="克隆-深拷贝" tabindex="-1">克隆（深拷贝） <a class="header-anchor" href="#克隆-深拷贝" aria-label="Permalink to &quot;克隆（深拷贝）&quot;">​</a></h4><p><strong>Rust 永远也不会自动创建数据的 “深拷贝”</strong>。因此，任何<strong>自动</strong>的复制都不是深拷贝，可以被认为对运行时性能影响较小。 如<code>String</code>类型需要深度复制可使用<code>clone</code>的方法（使用此方法会降低程序性能）：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">，</span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> s2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="拷贝-浅拷贝" tabindex="-1">拷贝（浅拷贝） <a class="header-anchor" href="#拷贝-浅拷贝" aria-label="Permalink to &quot;拷贝（浅拷贝）&quot;">​</a></h4><p>浅拷贝只发生在栈上，因此性能很高，在日常编程中，浅拷贝无处不在。如：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">x = </span><span style="color:#89DDFF;">{}</span><span style="color:#C3E88D;">, y = </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><blockquote><p>Rust 有一个叫做 <code>Copy</code> 的特征，可以用在类似整型这样在栈中存储的类型。如果一个类型拥有 Copy 特征，一个旧的变量在被赋值给其他变量后仍然可用。</p></blockquote><p>任何基本类型的组合都可以<code>Copy</code>，不需要分配内存或某种形式资源的类型是可以<code>Copy</code>的，如：</p><ul><li>所有整数类型，比如 u32</li><li>布尔类型，bool，它的值是 true 和 false</li><li>所有浮点数类型，比如 f64</li><li>字符类型，char</li><li>元组，当且仅当其包含的类型也都是 Copy 的时候。比如，(i32, i32) 是 Copy 的，但 (i32, String) 不是</li><li>不可变引用 &amp;T ，例如转移所有权中的最后一个例子，<strong>但可变引用 <code>&amp;mut T</code> 是不可以 <code>Copy</code>的</strong></li></ul><h3 id="函数传值与返回" tabindex="-1">函数传值与返回 <a class="header-anchor" href="#函数传值与返回" aria-label="Permalink to &quot;函数传值与返回&quot;">​</a></h3><p>将值传递给函数，一样会发生<code>移动</code>或者<code>复制</code>，就跟<code>let</code>语句一样，下面的代码展示了所有权、作用域的规则：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">  // s 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">takes_ownership</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">             // s 的值移动到函数里 ...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // ... 所以到这里不再有效</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">                      // x 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">makes_copy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">                  // x 应该移动函数里，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 但 i32 是 Copy 的，所以在后面可继续使用 x</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 这里, x 先移出了作用域，然后是 s。但因为 s 的值已被移走，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 所以不会有特殊操作</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">takes_ownership</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">some_string</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;"> // some_string 进入作用域</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> some_string</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 这里，some_string 移出作用域并调用 `drop` 方法。占用的内存被释放</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">makes_copy</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">some_integer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i32</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;"> // some_integer 进入作用域</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> some_integer</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 这里，some_integer 移出作用域。不会有特殊操作</span></span></code></pre></div><p>同样的，函数返回值也有所有权，例如:</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">gives_ownership</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">         // gives_ownership 将返回值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 移给 s1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">     // s2 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">takes_and_gives_back</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s2</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">  // s2 被移动到</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // takes_and_gives_back 中,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 它也将返回值移给 s3</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 这里, s3 移出作用域并被丢弃。s2 也移出作用域，但已被移走，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 所以什么也不会发生。s1 移出作用域并被丢弃</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">gives_ownership</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;">             // gives_ownership 将返回值移动给</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 调用它的函数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> some_string </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;"> // some_string 进入作用域.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  some_string</span><span style="color:#676E95;font-style:italic;">                              // 返回 some_string 并移出给调用的函数</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// takes_and_gives_back 将传入字符串并返回该值</span></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">takes_and_gives_back</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">a_string</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;"> // a_string 进入作用域</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  a_string</span><span style="color:#676E95;font-style:italic;">  // 返回 a_string 并移出给调用的函数</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="引用与借用" tabindex="-1">引用与借用 <a class="header-anchor" href="#引用与借用" aria-label="Permalink to &quot;引用与借用&quot;">​</a></h2><p><strong>获取变量的引用，称之为借用(borrowing)</strong></p><h3 id="引用与解引用" tabindex="-1">引用与解引用 <a class="header-anchor" href="#引用与解引用" aria-label="Permalink to &quot;引用与解引用&quot;">​</a></h3><p>常规引用是一个指针类型，指向了对象存储的内存地址。通过引用操作<code>&amp;</code>引用变量，在通过借引用操作符<code>*</code>解出引用指向的值（<strong>解引用</strong> ）如：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//引用x</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">assert_eq!</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 对y进行解引用，解析出y所指向的值，整数不能和引用作比较</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">assert_eq!</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="不可变引用和可变引用" tabindex="-1">不可变引用和可变引用 <a class="header-anchor" href="#不可变引用和可变引用" aria-label="Permalink to &quot;不可变引用和可变引用&quot;">​</a></h3><p>可通过将变量的引用传入函数，这样可避免值被丢弃（因为不曾拥有），同时代码会更加简洁。</p><p>同变量一样，没有通过<code>mut</code>声明默认不可变（不可变引用）</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_length</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_length</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">usize</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  s</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>可通过mut声明为可变引用：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">push</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  s</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push_str</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> word</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><strong>可变引用与不可变引用不能同时存在</strong>，因为借用不可变引用时如果出现可变引用时将会出现混乱。如下面的代码将会报错：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 没问题</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 没问题</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> s</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> // 大问题</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">{}</span><span style="color:#C3E88D;">, and </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>报错如下</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 无法借用可变 `s` 因为它已经被借用了不可变</span></span>
<span class="line"><span style="color:#A6ACCD;"> --&gt; src/main.rs:6:14</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">4 |     let r1 = &amp;s; // 没问题</span></span>
<span class="line"><span style="color:#A6ACCD;">  |              -- immutable borrow occurs here 不可变借用发生在这里</span></span>
<span class="line"><span style="color:#A6ACCD;">5 |     let r2 = &amp;s; // 没问题</span></span>
<span class="line"><span style="color:#A6ACCD;">6 |     let r3 = &amp;mut s; // 大问题</span></span>
<span class="line"><span style="color:#A6ACCD;">  |              ^^^^^^ mutable borrow occurs here 可变借用发生在这里</span></span>
<span class="line"><span style="color:#A6ACCD;">7 |</span></span>
<span class="line"><span style="color:#A6ACCD;">8 |     println!(&quot;{}, {}, and {}&quot;, r1, r2, r3);</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                                -- immutable borrow later used here 不可变借用在这里使用</span></span></code></pre></div><blockquote><p>注意，引用的作用域从创建开始，一直持续到它最后一次使用的地方，而变量的作用域从创建持续到某一个花括号 }</p></blockquote><p>在新版本编译器中，下面代码将不会报错，因为<strong>引用作用域的结束位置从花括号变成最后一次使用的位置</strong>：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}</span><span style="color:#C3E88D;"> and </span><span style="color:#89DDFF;">{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r2</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 新编译器中，r1,r2作用域在这里结束</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> r3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#C792EA;">mut</span><span style="color:#A6ACCD;"> s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">println!</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;{}&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> r3</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 老编译器中，r1、r2、r3作用域在这里结束</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 新编译器中，r3作用域在这里结束</span></span></code></pre></div><p><strong>Non-Lexical Lifetimes(NLL)</strong>：编译器优化行为，专门用于找到某个引用在作用域(<strong>}</strong>)结束前就不再被使用的代码位置。</p><h3 id="悬垂引用" tabindex="-1">悬垂引用 <a class="header-anchor" href="#悬垂引用" aria-label="Permalink to &quot;悬垂引用&quot;">​</a></h3><p>悬垂引用（悬垂指针）：某个指针指向某个值后，这个值被释放，但指针仍然存在，指针指向的内存可能不存在任何值或已被其他变量重新使用。 Rust中编译器可以确保引用永远也不会变成悬垂状态：当你获取数据的引用后，编译器可以确保数据不会在引用结束前被释放，要想释放数据，必须先停止其引用的使用。</p><p>如：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> reference_to_nothing </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dangle</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dangle</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#676E95;font-style:italic;"> // dangle 返回一个字符串的引用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;"> // s 是一个新字符串</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">s</span><span style="color:#676E95;font-style:italic;"> // 返回字符串 s 的引用</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#676E95;font-style:italic;"> // 这里 s 离开作用域并被丢弃。其内存被释放。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 危险！</span></span></code></pre></div><p>则会报错如下：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">error[E0106]: missing lifetime specifier</span></span>
<span class="line"><span style="color:#A6ACCD;"> --&gt; src/main.rs:5:16</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">5 | fn dangle() -&gt; &amp;String {</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                ^ expected named lifetime parameter</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">  = help: this function&#39;s return type contains a borrowed value, but there is no value for it to be borrowed from</span></span>
<span class="line"><span style="color:#A6ACCD;">help: consider using the `&#39;static` lifetime</span></span>
<span class="line"><span style="color:#A6ACCD;">  |</span></span>
<span class="line"><span style="color:#A6ACCD;">5 | fn dangle() -&gt; &amp;&#39;static String {</span></span>
<span class="line"><span style="color:#A6ACCD;">  |                ~~~~~~~~</span></span></code></pre></div><p>最好的解决方法是直接返回<code>String</code>：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">fn</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">no_dangle</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">from</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-37c6600e data-v-b95ca6a3><!--[--><!--]--><div class="edit-info" data-v-b95ca6a3><!----><div class="last-updated" data-v-b95ca6a3><p class="VPLastUpdated" data-v-b95ca6a3 data-v-962e51d6>Last updated: <time datetime="2023-05-13T09:24:44.000Z" data-v-962e51d6></time></p></div></div><div class="prev-next" data-v-b95ca6a3><div class="pager" data-v-b95ca6a3><!----></div><div class="pager" data-v-b95ca6a3><a class="pager-link next" href="/blog/rust/rust%E8%AF%AD%E8%A8%80%E5%9C%A3%E7%BB%8F%E7%AC%94%E8%AE%B0/1.%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/01.%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E4%B8%8E%E7%BB%93%E6%9E%84.html" data-v-b95ca6a3><span class="desc" data-v-b95ca6a3>Next page</span><span class="title" data-v-b95ca6a3>01.变量绑定与结构</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"rust_index.md\":\"df125f6f\",\"rust_rust语言圣经笔记_1.基础入门_01.变量绑定与结构.md\":\"357cbf09\",\"rust_rust语言圣经笔记_1.基础入门_02.基本类型.md\":\"7613de82\",\"index.md\":\"c301d44a\",\"rust_rust语言圣经笔记_1.基础入门_03.所有权与借用.md\":\"5601dc62\",\"rust_rust语言圣经笔记_1.基础入门_04.复合类型.md\":\"600ca705\",\"rust_rust语言圣经笔记_1.基础入门_05.流程控制.md\":\"72d9f0f0\",\"rust_rust语言圣经笔记_1.基础入门_07.方法 method.md\":\"fda16e30\",\"rust_rust语言圣经笔记_1.基础入门_08.泛型和特征.md\":\"e016e64f\",\"导航_index.md\":\"54fcaaad\",\"rust_rust语言圣经笔记_1.基础入门_06.匹配模式.md\":\"b2e5d51e\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"linyong's blog\",\"description\":\"my blog!\",\"base\":\"/blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"rust\",\"link\":\"/rust/\"},{\"text\":\"导航\",\"link\":\"/导航/\"}],\"sidebar\":{\"/rust\":[{\"text\":\"rust语言圣经笔记\",\"items\":[{\"text\":\"1.基础入门\",\"items\":[{\"text\":\"01.变量绑定与结构\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//01.变量绑定与结构\"},{\"text\":\"02.基本类型\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//02.基本类型\"},{\"text\":\"03.所有权与借用\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//03.所有权与借用\"},{\"text\":\"04.复合类型\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//04.复合类型\"},{\"text\":\"05.流程控制\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//05.流程控制\"},{\"text\":\"06.匹配模式\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//06.匹配模式\"},{\"text\":\"07.方法 Method\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//07.方法 Method\"},{\"text\":\"08.泛型和特征\",\"link\":\"/rust/rust语言圣经笔记//1.基础入门//08.泛型和特征\"}],\"collapsed\":true}],\"collapsed\":true}],\"/导航\":[]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/coder-linyong\"}],\"outline\":{\"level\":\"deep\",\"label\":\"本文大纲\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>